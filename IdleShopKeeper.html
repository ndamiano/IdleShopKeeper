<html>
	<head>
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
		<style>
			body {
			  margin: 0;
			  font-family: "Lato", sans-serif;
			  -webkit-user-select: none; /* Safari */        
		      -moz-user-select: none; /* Firefox */
			  -ms-user-select: none; /* IE10+/Edge */
			  user-select: none; /* Standard */
			  background: #555;
			  color: white;
			}

			.sidebar {
			  margin: 0;
			  padding: 0;
			  width: 200px;
			  background-color: #f1f1f1;
			  position: fixed;
			  height: 100%;
			  overflow: auto;
			  color: black;
			}
			.card {
			  color: black;
			  background-color: #f1f1f1;
			}

			.sidebar a {
			  display: block;
			  color: black;
			  padding: 16px;
			  text-decoration: none;
			}
			 
			.sidebar a.active {
			  background-color: #04AA6D;
			  color: white;
			}

			.sidebar a:hover:not(.active) {
			  background-color: #555;
			  color: white;
			}
			
			.sidebar h2 {
				padding: 16px;
			}
			
			.sidebar-info {
				padding: 0px 16px;
			}

			div.content {
			  margin-left: 200px;
			  padding: 1px 16px;
			  height: 1000px;
			}
		</style>
	</head>
	<body>
		<div class="sidebar">
			<h2>Stats</h2>
			<div class="sidebar-info">
				<span>Money: <span id="money">100</span></span><br>
				<span>Day: <span id="day">1</span></span><br>
				<span>Time: <span id="time">Morning</span></span>
				
			</div>
			<h2>Actions</h2>
			<a class="timeChange">Go to next time</a>
			<a class="shop">View your shop's stock</a>
			<a class="afternoon visit-shop" data-shop="armory" style="display:none">Visit armorer</a>
			<a class="afternoon buy-upgrades" style="display:none">Buy upgrades</a>
		</div>
		<div class="content">
			<!-- Player's shop -->
			<div class="top-level-content playerShopView" style="display:none">
				<h2 id="yourShop">Your Shop</h2>
				<div class="your-shop-item-container row">
				</div>
			</div>
			
			<!-- Buy items here -->
			<div class="top-level-content npcShopView" style="display:none">
				<h2 id="npcShopTitle">qqwerqwer</h2>
				<div id="npcShopMessage">
					<p>qwerqwer</p>
				</div>
				<div class="totalContainer" style="padding:10px 0px;">
					Total cost of selected items: <span id="totalCost">0</span>
					<input type="button" id="purchaseItems" value="Purchase">
				</div>
				<div class="npc-shop-item-container row">
					qwer
				</div>
			</div>
			
			<!-- Buy upgrades here -->
			<div class="top-level-content upgradeView" style="display:none">
				<h2>Upgrades</h2>
				<div>
					<p>Come look at my illicit wares! They're sure to give you an edge!</p>
				</div>
				<div class="upgrade-shop-item-container row">
					qwer
				</div>
				
			</div>
		</div>
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
		<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
		<script>
			// Add these to their own json file for localization later
			var strings = {
				morning: 'Morning',
				afternoon: 'Afternoon',
				evening: 'Evening',
				npcShops: {
					"armory": {
						name: "Armory",
						message: "Welcome to my armory, please take a look around!"
					}
				},
				itemDetails: {
					"plate1": {
						name: "Iron Platebody",
						description: "A set of weak armor"
					},
					"plate2": {
						name: "Steel Platebody",
						description: "A set of medium strength armor"
					},
				},
				upgradeDetails: {
					"multi1": {
						name: "Charisma booster",
						description: "This little device will make your salespeople more charismatic, making them sell items for 25% more!"
					}
				}
			}
			
			// Static game data
			class Category {
				static ARMOR = new Category("armor")
				constructor(name) {
					this.name = name;
				}
			}
			
			// This will move into separate json file(s)
			var products = {
				// Name / description are grabbed from strings
				"plate1": {
					id: "plate1",
					purchaseCost: 100,
					sellPrice: 150,
					category: Category.ARMOR,
					requirements: [],
					availableIn: ["armory"]
				},"plate2": {
					id: "plate2",
					purchaseCost: 200,
					sellPrice: 310,
					category: Category.ARMOR,
					requirements: [],
					availableIn: ["armory"]
				},
			}
			
			var upgrades = {
				"multi1": {
					id: "multi1",
					cost: 500,
					value: 0.25,
					type: "multiplier",
					purchased: false,
				}
			}
			
			// Player's game data
			var game = {
				currentTime: 'morning',
				day: 1
			};
			var player = {
				money: 100,
				items: {},
				upgrades: []
			}
			
			// Add functionality
			$(function() {
				$('.timeChange').on('click', changeTime);
				$('.visit-shop').on('click', function() { viewNPCShop($(this).data('shop')) });
				$('.shop').on('click', viewYourShop);
				$('.npc-shop-item-container').on('change', '.purchase-item', calculateCost);
				$('.upgrade-shop-item-container').on('click', '.buy-upgrade', function() { buyUpgrade($(this)) });
				$('.buy-upgrades').on('click', viewUpgrades);
				$('#purchaseItems').on('click', purchaseItems);
			});
			
			// Game Functions
			function viewNPCShop(shopType) {
				// Display strings
				var shopStrings = strings.npcShops[shopType];
				$('#npcShopTitle').text(shopStrings.name);
				$('#npcShopMessage').text(shopStrings.message);
				
				// Display items
				productsForShop = getProductsForShop(shopType);
				$('.npc-shop-item-container').html("");
				productsForShop.forEach(element => {
					var card = createCardForItem(element, false);
					$('.npc-shop-item-container').append(card);
				});
				
				// Hide other top level content
				$('.top-level-content').each(function(i, element) {
					$(element).hide();
				});
				
				// Display Shop
				calculateCost();
				$('.npcShopView').show();
			}
			
			function viewYourShop() {
				// Display items
				$('.your-shop-item-container').html("");
				Object.keys(player.items).forEach(element => {
					var item = products[element];
					item.quantity = player.items[element];
					var card = createCardForItem(item, true);
					$('.your-shop-item-container').append(card);
				});
				
				// Hide other top level content
				$('.top-level-content').each(function(i, element) {
					$(element).hide();
				});
				
				// Display Shop
				$('.playerShopView').show();
			}
			
			function viewUpgrades() {
				// Display items
				$('.upgrade-shop-item-container').html("");
				Object.keys(upgrades).forEach(element => {
					var upgrade = upgrades[element];
					if (upgrade.purchased) {
						return;
					}
					var card = createCardForUpgrade(upgrade);
					$('.upgrade-shop-item-container').append(card);
				});
				
				// Hide other top level content
				$('.top-level-content').each(function(i, element) {
					$(element).hide();
				});
				
				// Display Shop
				$('.upgradeView').show();
			}

			function createCardForItem(item, isYourShop) {
				return $('<div></div>').addClass('col-sm-2').append(
					$('<div></div>')
					.addClass('card')
					.append(
						$('<div></div>')
							.addClass('card-body')
							.append(
								$('<h5></h5>')
									.addClass('card-title')
									.append(strings.itemDetails[item.id].name)
							)
							.append(
								$('<p></p>')
									.addClass('card-text')
									.append(strings.itemDetails[item.id].description)
							)
							.append(
								isYourShop ?
									$('<p></p>')
										.addClass('card-text')
										.append($('<b></b>').append("Sell Price: "))
										.append(item.sellPrice)
								:
									$('<p></p>')
										.addClass('card-text')
										.append($('<b></b>').append("Purchase Price: "))
										.append(item.purchaseCost)
							)
							.append(
								isYourShop ?
									$('<p></p>')
										.addClass('card-text')
										.append($('<b></b>').append("Number Owned: "))
										.append(item.quantity)
								:
									$('<input type="number" value="0">')
										.addClass("form-control")
										.addClass("purchase-item")
										.data('id', item.id)
										.data('price', item.purchaseCost)
							)
					)
					.css("margin-bottom", "15px")
				)
			}
			
			function createCardForUpgrade(upgrade) {
				return $('<div></div>').addClass('col-sm-2').append(
					$('<div></div>')
					.addClass('card')
					.append(
						$('<div></div>')
							.addClass('card-body')
							.append(
								$('<h5></h5>')
									.addClass('card-title')
									.append(strings.upgradeDetails[upgrade.id].name)
							)
							.append(
								$('<p></p>')
									.addClass('card-text')
									.append(strings.upgradeDetails[upgrade.id].description)
							)
							.append(
								$('<p></p>')
									.addClass('card-text')
									.append($('<b></b>').append("Cost: "))
									.append(upgrade.cost)
							)
							.append(
								$('<button value="purchase">Purchase</button>')
									.addClass("btn")
									.addClass("form-control")
									.addClass("btn-secondary")
									.addClass("buy-upgrade")
									.data('id', upgrade.id)
									.data('price', upgrade.cost)
							)
					)
					.css("margin-bottom", "15px")
				)
			}

			function changeTime() {
				switch (game.currentTime) {
					case 'morning':
						game.currentTime = 'afternoon';
						// Update available actions
						$('.morning').hide();
						$('.afternoon').show();
						break;
					case 'afternoon':
						game.currentTime = 'evening';
						// Update available actions
						$('.afternoon').hide();
						$('.evening').show();
						break;
					case 'evening':
						game.day++;
						game.currentTime = 'morning';
						// Update available actions
						$('.evening').hide();
						$('.morning').show();
						sellItems();
						break;
				}
				refreshView();
				// Hide whatever they were doing prior by bringing them to their shop
				viewYourShop();
			}
			
			function calculateCost() {
				var total = 0;
				$('.purchase-item').each(function(i, element) {
					total += $(element).val() * $(element).data('price');
				});
				$('#totalCost').html(total);
				return total;
			}
			
			function getProductsForShop(shopType) {
				productsForShop = [];
				Object.keys(products).forEach(element => {
					product = products[element];
					if (product.availableIn.includes(shopType)) {
						productsForShop.push(product);
					}
				});
				return productsForShop;
			}
			
			function purchaseItems() {
				var cost = calculateCost();
				if (cost > player.money) {
					return;
				} else {
					player.money -= cost;
				}
				$('.purchase-item').each(function(i, element) {
					if ($(element).val() <= 0) {
						return;
					}
					if (player.items[$(element).data('id')] == undefined) {
						player.items[$(element).data('id')] = 0;
					}
					player.items[$(element).data('id')] += parseInt($(element).val());
				});
				changeTime();
			}

			function sellItems() {
			
				var upgradeMultiplier = 1;
				player.upgrades.forEach(function(element) {
					var upgrade = upgrades[element];
					if (upgrade.type == "multiplier") {
						upgradeMultiplier += upgrade.value;
					}
				});
				console.log(upgradeMultiplier);
				Object.keys(player.items).forEach(element => {
					var item = products[element];
					var quantity = player.items[element];
					player.money += Math.floor(item.sellPrice * quantity * upgradeMultiplier);
					delete player.items[element];
				});
				refreshView();
			}
			
			function refreshView() {
				$('#day').text(game.day);
				$('#time').text(strings[game.currentTime]);
				$('#money').text(player.money);
			}

			function buyUpgrade(upgrade) {
			console.log(upgrade);
				var price = parseInt(upgrade.data('price'))
				if (player.money >= price) {
					player.money -= price;
					player.upgrades.push(upgrade.data('id'));
					upgrades[upgrade.data('id')].purchased = true;
				}
				changeTime();
			}

		</script>
	</body>
</html>